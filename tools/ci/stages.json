{
    "stages": [
        {
            "commands": [
                "./tools/bazel test ... --output_groups=+metadata --config=dev --config=clang-tidy --platform_suffix=clang-tidy"
            ],
            "name": "clang-tidy",
            "tags": [
                "x86_64",
                "clang"
            ]
        },
        {
            "commands": [
                "./tools/bazel test ... --output_groups=+metadata --config=clang --config=prod --config=cc --platform_suffix=clang-prod"
            ],
            "name": "clang prod",
            "tags": [
                "x86_64",
                "clang"
            ]
        },
        {
            "commands": [
                "./tools/bazel test ... --output_groups=+metadata --config=gcc --config=prod --config=cc --platform_suffix=gcc-prod"
            ],
            "name": "gcc prod",
            "tags": [
                "x86_64",
                "gcc"
            ]
        },
        {
            "commands": [
                "./tools/bazel run tools/docker_images:xtensa_qemu",
                "./tools/bazel test ... --output_groups=+metadata --config=esp32 --config=prod --config=cc --platform_suffix=esp32-prod"
            ],
            "name": "esp32 prod",
            "tags": [
                "esp32",
                "gcc"
            ]
        },
        {
            "category": "stress",
            "commands": [
                "./tools/bazel test ... --build_tests_only --test_tag_filters=stress,-cc-coverage --config=dev --runs_per_test={runs} --platform_suffix=stress-dev"
            ],
            "name": "dev ({runs} runs)",
            "tags": [
                "x86_64",
                "clang",
                "dev"
            ]
        },
        {
            "category": "stress",
            "commands": [
                "./tools/bazel test ... --build_tests_only --test_tag_filters=stress,-cc-coverage --config=prod --runs_per_test={runs} --platform_suffix=stress-prod"
            ],
            "name": "prod ({runs} runs)",
            "tags": [
                "x86_64",
                "clang",
                "prod"
            ]
        },
        {
            "category": "sanitizer",
            "commands": [
                "./tools/bazel test ... --config=clang --config=cc --config=sanitizer --config=asan --config=lsan --config=ubsan --platform_suffix=clang-asan-lsan-ubsan"
            ],
            "name": "asan/lsan/ubsan",
            "tags": [
                "x86_64",
                "clang",
                "static_analyzer"
            ]
        },
        {
            "category": "sanitizer",
            "commands": [
                "./tools/bazel test ... --config=clang --config=cc --config=sanitizer --config=tsan --platform_suffix=clang-tsan"
            ],
            "name": "tsan",
            "tags": [
                "x86_64",
                "clang",
                "static_analyzer"
            ]
        },
        {
            "category": "coverage",
            "commands": [
                "./tools/bazel coverage cc/... --config=gcc --config=cc --platform_suffix=coverage-cc && ./tools/bazel run tools/coverage --platform_suffix=coverage-cc -- --output bazel-out/coverage-cc"
            ],
            "name": "C++",
            "output": "bazel-out/coverage-cc",
            "tags": [
                "x86_64",
                "cc"
            ]
        },
        {
            "category": "coverage",
            "commands": [
                "./tools/bazel coverage ... --config=nodejs --platform_suffix=coverage-nodejs && ./tools/bazel run tools/coverage --platform_suffix=coverage-nodejs -- --output bazel-out/coverage-nodejs"
            ],
            "name": "NodeJs",
            "output": "bazel-out/coverage-nodejs",
            "tags": [
                "x86_64",
                "nodejs"
            ]
        },
        {
            "category": "sanitizer",
            "commands": [
                "./sanitize.sh"
            ],
            "name": "sanitizer",
            "tags": []
        }
    ]
}